{"layout":"post","title":"How to check php compatibility","categories":["articles"],"tags":["PHP","Code","Sniffer"],"body":"<p>Sometimes do you receive the scary mission of validate if your <a href=\"http://www.php.net\">PHP</a> project will continue working if we upgrade or\ndowngrade the PHP version used in production server.</p>\n<p>As you can imagine this is really complex task, because you have determine what pieces of code must to be changed in\norder to continue working under new server conditions and any omission could be and would be a huge responsibility above\nyour shoulders.</p>\n<p>Therefore, what you can do? trust in your good judge about code compatibility sounds like a bad approach and indeed it’s \na terrible approach even though if you really believe do you know really well the application.</p>\n<p>Fortunately, there are some open source project to enable you to do this check automatically and today I will talk more \nspecifically about the project <a href=\"https://github.com/wimg/PHPCompatibility\">PHPCompatibility</a>.</p>\n<p>#Install PHP CodeSniffer</p>\n<p>It’s possible install PHP CodeSniffer using PEAR, but I would recommend use composer instead of.</p>\n<p>Is necessary inform to you system where PHP CodeSniffer binary <strong>phpcs</strong> could found after install with composer using \nthe following command.</p>\n<pre><code>export PATH=~/.composer/vendor/bin:$PATH\n</code></pre><p>After that we must execute composer to install PHP CodeSniffer using the following command.</p>\n<pre><code>composer global require &quot;squizlabs/php_codesniffer=2.*&quot;\n</code></pre><p>To check the installation was success we could check running this command. This command will list the installed coding standards.</p>\n<pre><code>$ phpcs -i\nThe installed coding standards are MySource, PEAR, PHPCS, PSR1, PSR2, Squiz and Zend\n</code></pre><p>Those code standards are located at <strong>~/.composer/vendor/squizlabs/php_codesniffer/CodeSniffer/Standards</strong></p>\n<p>#Installing PHPCompatibility code standard.</p>\n<p>To download PHPCompatibility code standard we have to follow these instructions.</p>\n<pre><code>$ ~/.composer/vendor/squizlabs/php_codesniffer/CodeSniffer/Standards\n$ git clone https://github.com/wimg/PHPCompatibility.git\n</code></pre><p>Using <strong>phpcs -i</strong> we can double check the new code standard is available to be used.</p>\n<pre><code>$ phpcs -i\nThe installed coding standards are MySource, PEAR, PHPCompatibility, PHPCS, PSR1, PSR2, Squiz and Zend\n</code></pre><p>#Checking compatibility</p>\n<p>Firstly, you have to define if you a report including errors or warnings or both, in my case I want to exclude warning \njust to focus in fatal error of php I could get after a PHP upgrade in my production server using the following configuration \nfor <strong>phpcs</strong>.</p>\n<pre><code>phpcs --config-set error_severity 1\nphpcs --config-set warning_severity 0\n</code></pre><h2 id=\"executive-report\">Executive report</h2>\n<p>If you want to show to your superior an executive report about how will be an upgrade/downgrade of PHP version in your\n application, you can get an overview report using the following command.</p>\n<pre><code>$ phpcs --report=source --standard=PHPCompatibility --extensions=php,inc,module,install --runtime-set testVersion 5.5 -pvs .\n</code></pre><p>The command about analyze all files with extension .php, .inc, .module and .install because and I want to analyze a <a href=\"http://drupal.org\">Drupal</a> \nproject, moreover, I want to check the compatibility of this project with PHP 5.5 showing the progress of this analysis.</p>\n<p>This command will generate an output similar to following list.</p>\n<pre><code>PHP CODE SNIFFER VIOLATION SOURCE SUMMARY\n----------------------------------------------------------------------\nSOURCE                                                           COUNT\n----------------------------------------------------------------------\nPHPCompatibility.PHP.RemovedExtensions                           365\nPHPCompatibility.PHP.DeprecatedNewReference                      153\nPHPCompatibility.PHP.ForbiddenNamesAsInvokedFunctions            6\nPHPCompatibility.PHP.DeprecatedFunctions                         3\n----------------------------------------------------------------------\nA TOTAL OF 527 SNIFF VIOLATIONS WERE FOUND IN 4 SOURCES\n----------------------------------------------------------------------\n\nTime: 3 mins, 46.3 secs; Memory: 185.25Mb\n</code></pre><h2 id=\"detailed-report\">Detailed report</h2>\n<p>To evaluate the statement of work to be prepared for the PHP version change, we can get a detail report in a file using \nthis command.</p>\n<pre><code>phpcs --standard=PHPCompatibility --extensions=php,inc,module,install --report-full=/Users/enzo/Desktop/CS-report.txt --runtime-set testVersion 5.5 -pvs .\n</code></pre><p>The command above will produce an output similar to this.</p>\n<pre><code>FILE: /Users/enzo/drupal/includes/common.inc\n----------------------------------------------------------------------\nFOUND 1 ERROR AFFECTING 1 LINE\n----------------------------------------------------------------------\n 1797 | ERROR | &#39;clone&#39; is a reserved keyword introduced in PHP version\n      |       | 5.0 and cannot be invoked as a function (T_CLONE)\n      |       | (PHPCompatibility.PHP.ForbiddenNamesAsInvokedFunctions)\n----------------------------------------------------------------------\n</code></pre><p>I hope you found this post useful.</p>\n","updatedAt":"2017-09-05T17:40:56.000Z"}
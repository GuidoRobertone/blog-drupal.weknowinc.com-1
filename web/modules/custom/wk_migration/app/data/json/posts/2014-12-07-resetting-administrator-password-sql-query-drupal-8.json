{"layout":"post","title":"Resetting the administrator password with sql-query in Drupal 8","description":"How to recovery the access to a Drupal 8 website","categories":["articles"],"tags":["Drupal","MySQL","Recovery","Password"],"draft":false,"body":"<p>#The Problem</p>\n<p>When in Drupal 8, the password for user #1 (the administrator) is lost and the email notification don’t work, it is possible to set the password via a database query.</p>\n<p>Right now we are in the middle of the development of Drupal 8 and the usual command <a href=\"http://www.drushcommands.com/drush-6x/user/user-login\" target=\"_blank\"><strong>drush uli</strong></a> provided by <a href=\"http://www.drush.org/\" target=\"_blank\"></a>Drush doesn’t work.</p>\n<p>Right now when I try to execute that command I got the following error.</p>\n<pre><code>Fatal error: Call to undefined function url() in /Users/enzo/.composer/vendor/drush/drush/commands/user/user.drush.inc on line 466\nDrush command terminated abnormally due to an unrecoverable error.\n</code></pre><p>#The Solution</p>\n<p>##Generate a new password</p>\n<p>First, you have to generate a password hash that is valid for your site.</p>\n<p>Execute the following commands from the command line, in the Drupal 8 root directory:</p>\n<pre><code>$ php core/scripts/password-hash.sh &#39;your-new-pass-here&#39;\n\npassword: your-new-pass-here    hash: $S$EV4QAYSIc9XNZD9GMNDwMpMJXPJzz1J2dkSH6KIGiAVXvREBy.9E\n</code></pre><p>Be careful not to include more or less characters as the hash. These hashes look somewhat like <strong>$S$EV4QAYSIc9XNZD9GMNDwMpMJXPJzz1J2dkSH6KIGiAVXvREBy.9E</strong>.</p>\n<p>We will use the generated password later.</p>\n<h2 id=\"update-the-user-password-\">Update the user password.</h2>\n<p>Now you need to update the user password, in our case we need update the Administrator password, fortunately the UID for Administrator is 1 equal to previous versions of Drupal.</p>\n<p>With the new password we need run the following SQL statement.</p>\n<pre><code>UPDATE users_field_data SET pass=&#39;$S$E5j59pCS9kjQ8P/M1aUCKuF4UUIp.dXjrHyvnE4PerAVJ93bIu4U&#39; WHERE uid = 1;\n</code></pre><h2 id=\"dealing-with-cache\">Dealing with Cache</h2>\n<p>At this point if you try to login in the Drupal 8 website you will rejected, it’s because the login system don’t read directly the table <strong>users_field_data</strong> instead of a cache for entities is used.</p>\n<p>To flush the cache for a specific user entity with compromise the rest of cache of your system you can use the following SQL statement.</p>\n<pre><code>DELETE FROM cache_entity WHERE cid = &#39;values:user:1&#39;;\n</code></pre><p>Now you can grab a cup of coffee/tea and enjoy your Drupal 8 website.</p>\n<p>I hope you found this article useful.</p>\n","updatedAt":"2017-09-05T17:40:56.000Z"}